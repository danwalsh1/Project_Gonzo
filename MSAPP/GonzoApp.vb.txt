Imports System.Net
Imports System.IO
Imports System.Diagnostics


Public Class frmProjGon
    Dim data_Send As sendData

    Private Sub frmProjGon_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        data_Send = New sendData(10000, Me)
        data_Send.startSending()
    End Sub
End Class

Public Class sendData
    Private WithEvents gonzoTimer As New System.Windows.Forms.Timer
    Private gonzoForm As frmProjGon
    Private batteryData As PowerStatus
    Private batLevel As Integer
    Private deviceID As String
    Private chargingState As PowerLineStatus
    Private UsageCPU As New PerformanceCounter
    Private CPUoutput As String

    Public Sub New(gonzoInterval As Integer, monitorform As frmProjGon)
        gonzoTimer = New System.Windows.Forms.Timer
        gonzoTimer.Interval = gonzoInterval
        gonzoForm = monitorform
    End Sub

    Public Property CPUstring As String
    Public Event Load(sender As Object, e As EventArgs)

    Public Sub startSending()
        gonzoTimer.Start()
    End Sub

    Public Sub stopSending()
        gonzoTimer.Stop()
    End Sub

    Private Sub intervalTick() Handles gonzoTimer.Tick
        With UsageCPU
            .CategoryName = "Processor"
            .CounterName = "% Processor Time"
            .InstanceName = "_Total"
        End With

        batteryData = SystemInformation.PowerStatus 'Assign power status function to variable batteryData
        batLevel = batteryData.BatteryLifePercent * 100
        deviceID = My.Computer.Name
        chargingState = batteryData.PowerLineStatus
        CPUoutput = UsageCPU.NextValue()
        gonzoForm.lblBatLevData.Text = batLevel
        gonzoForm.lblDevIDData.Text = deviceID
        gonzoForm.lblChargeStateData.Text = chargingState
        gonzoForm.lblCPU.Text = UsageCPU.NextValue()
        Page_Load()

    End Sub

    Private Sub Page_Load()
        Dim chargeString As String
        If chargingState = PowerLineStatus.Online Then
            chargeString = "true"
        Else
            chargeString = "false"
        End If


        Dim urlCPU As String = "http://projectgonzocoventry.000webhostapp.com/app_page/insertData.php?deviceid=" & deviceID & "&cpu=" & CPUoutput
        Dim CPUSend As WebRequest = WebRequest.Create(urlCPU)
        CPUSend.GetResponse()

        Dim url As String = "http://projectgonzocoventry.000webhostapp.com/app_page/insertData.php?deviceid=" & deviceID & "&batlevel=" & batLevel & "&chargestate=" & chargeString
        Dim request As WebRequest = WebRequest.Create(url)
        request.GetResponse()

    End Sub



End Class
