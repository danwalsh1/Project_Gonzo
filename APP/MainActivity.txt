package com.example.salazhar.projectgonzo;

import android.content.Intent;
import android.os.BatteryManager;
import android.os.Build;
import android.provider.Settings;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.TextView;
import android.content.BroadcastReceiver;
import android.content.IntentFilter;
import android.content.Context;
import android.net.Uri;
import android.view.View;

public class MainActivity extends AppCompatActivity {
                        //Initialises variables with varying types.
    String Address;
    public int level;
    String NameOfPhone = Build.MODEL; //Sets the phones name equal to the NameOfPhone variable.
    String state;
    public boolean isCharging;

    public BroadcastReceiver BatteryChange = new BroadcastReceiver() {
        @Override
        public void onReceive(Context c, Intent i) {

            //For future reference the battery level is stored inside the 'level' variable.
            //Get the battery level and assign it to the 'level' variable. If the program cannot get a level it will set the battery level to 0 by default.
            level = i.getIntExtra("level", 0);
            //Find textview control created in activity_main.xml
            TextView tv = (TextView) findViewById(R.id.BatteryLevel);
            //Set the BatteryLevel text field as 'Battery level *batterylevelhere* %'.
            tv.setText("Battery Level: " + Integer.toString(level) + "%");

            //Finding the charge state.
            int status = i.getIntExtra(BatteryManager.EXTRA_STATUS, -1);
            isCharging = status == BatteryManager.BATTERY_STATUS_CHARGING ||
                    status == BatteryManager.BATTERY_STATUS_FULL;
            if (isCharging == true) {
                state = " Charging.";
            }else if (isCharging == false) {
                state = " Not Charging.";
            }
            TextView cs = (TextView) findViewById(R.id.ChargeState);
            cs.setText("Charge State:"+state);
        }
    };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        //Register the receiver which triggers the event 'BatteryChange' when the battery level changes. This in turn then changes the text on the screen to say the now current battery life.
        registerReceiver(BatteryChange, new IntentFilter(Intent.ACTION_BATTERY_CHANGED));
    }

    public void OpenBrowser(View view){
        //Creates a new browser session that opens a certain website.
        Address = "https://projectgonzocoventry.000webhostapp.com/app_page/insertData.php?deviceid="+NameOfPhone+"&batlevel="+level+"&chargestate="+isCharging;
        Intent browserIntent=new Intent(Intent.ACTION_VIEW, Uri.parse(Address));
        startActivity(browserIntent);
    }

}
